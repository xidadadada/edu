<html>
<body>
    <script type="text/javascript" src="../edu/day.js">
</script>
<script type="text/javascript" src="../edu/ps.js">
</script>
<div class=“rich_media_area_primary” style="margin:0px auto; width:800px;">
                
<div class="rich_media_area_primary">
                
                <h2 class="rich_media_title" title="oracle 和 mysql 和 nosql">oracle 和 mysql 和 nosql</h2>
                <div class="rich_media_meta_list">
                    <!-- <span class="rich_media_meta meta_original_tag dn"></span>
                    <a class="rich_media_meta meta_enterprise_tag" href="javascript:;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/QpRnoicU4ABbjkE59REvAMSTDRgGT5j0fpvcH4FJJv2K2UVjhteibDRqZHU5B2jAP8jIiaHVOicUp6yYiahJS7KtJsQ/0?wx_fmt=jpeg"></a> -->
                    <em class="rich_media_meta rich_media_meta_text">2018-02-22</em>
                    <em class="rich_media_meta rich_media_meta_text"></em>
                    <span class="rich_media_meta rich_media_meta_link" title="请发送到手机查看完整效果">学习交流</span>
                </div>
                
                              
                <div class="rich_media_content">
                    
                    <p><span style="font-size: 15px;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);">Oracle传统使用方法：存储使用EMC阵列（容量大，数据安全），IBM服务器，即IOE组合，这三个组合很强大（高可用，高性能），但是也高价格。</span></span></span></span></p><p><span style="font-size: 15px;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><br></span></span></span></p><p><span style="font-size: 15px;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);">占 80% 市场份额的 20% 大型互联网公司用的是 Oracle，提供精确数据云服务端；20% 市场份额 80% 中小型互联网公司依赖于 MySQL，物美价廉还开源。</span>mysql现已被oracle收购了。大公司和对可靠性、安全性要求比较高的系统用oracle很多，mysql在小公司、小项目、互联网非最核心数据中应用较多。mysql开源的性质使得其有较强的定制型，还有就是免费。</span></span></p><p><span style="font-size: 15px;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><br></span></p><p><span style="font-size: 15px;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;white-space: pre-wrap;background-color: rgb(255, 255, 255);">但大型互联网公司不一定都是使用Oracle，主线业务很可能还是MySQL，或者是基于MySQL二次开发的数据库。比如淘宝有淘宝MySQL（淘宝甚至还有OceanBase），腾讯有TMySQL。MySQL的还有Percona Server，Mariadb等等，这些数据库也有很好的性能。现在互联网更多使用No SQL技术，比如MongoDB，<span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);">Cassandra</span>等等，还会使用大数据平台，比如Hbase、Hadoop等等。</span>Facebook的photo访问服务图，数据库是在最末端，Cache层已经服务了90%的需求，对于热点图片命中率接近100%。同时，Facebook上所有用户进行读的操作远大于其写的操作，因此Cassandra这样的写非常快的NoSQL数据库，Facebook并没有采用。<span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;">用 Event sourcing 的方法，去減少數據庫的負擔，直接把事件流存在內存中，只是定时 snapshot 一下或者是儲存一些不用即時更新的數據。</span>而且出现问题不必苦等Oracle；容灾最好就用 GoldenGate，集群最好用 RAC 等等oracle相关产品；而且技术积累也是非常重要。</p><p><br></p><ul class=" list-paddingleft-2"><li><p>关系型数据库适合存储结构化数据，如用户的帐号、地址</p></li><ul class=" list-paddingleft-2" style="list-style-type: square;"><li><p>这些数据通常需要做结构化查询（嗯，好像是废话），比如join，这时候，关系型数据库就要胜出一筹</p></li><li><p>这些数据的规模、增长的速度通常是可以预期的</p></li><li><p>事务性、一致性</p></li></ul><li><p>NoSQL适合存储非结构化数据，如文章、评论</p></li><ul class=" list-paddingleft-2" style="list-style-type: square;"><li><p>这些数据通常用于模糊处理，如全文搜索、机器学习</p></li><li><p>这些数据是海量的，而且增长的速度是难以预期的，</p></li><li><p>根据数据的特点，NoSQL数据库通常具有无限（至少接近）伸缩性</p></li><li><p>按key获取数据效率很高，但是对join或其他结构化查询的支持就比较差</p></li></ul></ul><p><br><span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);">不管你学的是什么sql，一定要把group by、partition和index的各种用法搞明白，能不能写出一手好sql的分水岭就在这里。DBA的核心知识在于安装配置数据库，数据库管理，数据备份，性能优化和故障处理。</span><br></p><p><span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><br></span></p><p><span style="color:#1a1a1a;font-family:-apple-system, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif;"><span style="font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);">mysql 优化：</span></span></p><p><span style="color:#1a1a1a;font-family:-apple-system, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif;"><span style="font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><br></span></span></p><p><span style="color:#1a1a1a;font-family:-apple-system, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif;"><span style="font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);"></span></span></p><p>第一优化你的sql和索引；</p><p><br></p><p>myisam读好，写差，它是顺序存储的（innodb是聚簇索引），他的索引节点是一个指向数据物理位置的指针，所以查找起来很快，（innodb索引节点存的则是数据的主键，所以需要根据主键二次查找）；myisam锁是表锁，只有读读之间是并发的，写写之间和读写之间（读和插可以并发，设置concurrent_insert参数）是串行的，所以慢，并且默认的写优先级高，批量写，会导致读请求挂掉，所以要设置读写优先级或设置多少写操作后执行读操作的策略; myisam不要使用查询时间太长的sql，否则也会导致写挂掉，所以尽量去拆分查询效率低的sql。</p><p><br></p><p>innodb一般都是行锁，如果用到索引，行锁是加在索引上的；如果没有用到索引，仍然会锁定表。读写可以并发，普通的select是不需要锁的，当查询的记录遇到锁时，会去读被锁定行的快照，其它更新或加锁读语句读取原始行；因为普通读与写不冲突，所以innodb不会出现读写挂掉的情况，又因为在使用索引的时候用的是行锁，锁的粒度小，竞争相同锁的情况就少，就增加了并发处理，所以并发读写的效率还是很优秀的，问题在于索引查询后的根据主键的二次查找导致效率低。<span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);">innodb为了避免二次查找可以使用索引覆盖技术，无法使用索引覆盖的，再延伸一下就是基于索引覆盖实现延迟关联。而且</span><span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;">InnoDB引擎可以多利用点内存，减轻磁盘IO负载，因为IO往往是数据库服务器的瓶颈。</span></p><p style="margin-bottom: 0.72em;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;"><br></p><p style="margin-bottom: 0.72em;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;">若是读为主，可以考虑打开query_cache，以及调整一些参数值：sort_buffer_size,read_buffer_size,read_rnd_buffer_size,join_buffer_size<br></p><p><span class="RichText CopyrightRichText-richText" itemprop="text" style="word-break: break-word;white-space: pre-wrap;">设计合适的索引,基于主键的查找,上亿数据也是很快的; 以空间换时间,避免join,有些join操作可以在用代码实现,没必要用数据库来实现;足够的buffer,尽量让内存大于数据.</span></p><p><span class="RichText CopyrightRichText-richText" itemprop="text" style="word-break: break-word;white-space: pre-wrap;"><br></span></p><p><span class="RichText CopyrightRichText-richText" itemprop="text" style="word-break: break-word;white-space: pre-wrap;"></span></p><p>Buffer的核心作用是用来缓冲，缓和冲击。Cache的核心作用是加快取用的速度。当然Buffer不一定就是用来写的，Cache不一定就是用来读的。Cache或Buffer只要相对高速即可。</p><p><br><br></p><p><span class="RichText CopyrightRichText-richText" itemprop="text" style="word-break: break-word;white-space: pre-wrap;"></span></p><ol class=" list-paddingleft-2"><li><p>经常需要计算和排序等消耗CPU的字段,应该尽量选择更为迅速的字段，如用TIMESTAMP(4个字节，最小值1970-01-01 00:00:00)代替Datetime（8个字节，最小值1001-01-01 00:00:00）,整型替代浮点型和字符型</p></li><li><p>变长字段使用varchar，不要使用char</p></li><li><p>对于二进制多媒体数据，流水队列数据(如日志)，超大文本数据不要放在数据库字段中</p></li><li><p><span style="color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);">访问频率较低的大字段拆分出数据表。</span><br></p></li></ol><p><br></p><p><strong style="font-size: 16px;">数据库索引</strong><br></p><p><strong style="font-size: 16px;"><br></strong></p><p>业务不需要的不要建索引，不允许在联合索引（或主键）中存在多余的字段。特别是该字段根本不会在条件语句中出现。</p><p><br></p><p>唯一确定一条记录的一个字段或多个字段要建立主键或者唯一索引，不能唯一确定一条记录，为了提高查询效率建普通索引。</p><p><br></p><p>业务使用的表，有些记录数很少，甚至只有一条记录，为了约束的需要，也要建立索引或者设置主键。</p><p><br></p><p>对于取值不能重复，经常作为查询条件的字段，应该建唯一索引(主键默认唯一索引)，并且将查询条件中该字段的条件置于第一个位置。没有必要再建立与该字段有关的联合索引。</p><p><br></p><p>对于经常查询的字段，其值不唯一，也应该考虑建立普通索引，查询语句中该字段条件置于第一个位置，对联合索引处理的方法同样。</p><p><br></p><p>业务通过不唯一索引访问数据时，需要考虑通过该索引值返回的记录稠密度，原则上可能的稠密度最大不能高于0.2，如果稠密度太大，则不合适建立索引了。</p><p><br></p><p>需要联合索引(或联合主键)的数据库要注意索引的顺序。SQL语句中的匹配条件也要跟索引的顺序保持一致。<br></p><p>注意：索引的顺势不正确也可能导致严重的后果。</p><p><br></p><p>表中的多个字段查询作为查询条件，不含有其他索引，并且字段联合值不重复，可以在这多个字段上建唯一的联合索引，假设索引字段为 (a1,a2,...an),则查询条件(a1 op val1,a2 op val2,...am op valm)m&lt;=n,可以用到索引，查询条件中字段的位置与索引中的字段位置是一致的。</p><p><br></p><p>联合索引的建立原则(以下均假设在数据库表的字段a,b,c上建立联合索引(a,b,c))</p><p><br></p><p>重要业务访问数据表时。但不能通过索引访问数据时，应该确保顺序访问的记录数目是有限的，原则上不得多于10.</p><h2></h2><p><span class="RichText CopyrightRichText-richText" itemprop="text" style="word-break: break-word;white-space: pre-wrap;"><br></span></p><p><span class="RichText CopyrightRichText-richText" itemprop="text" style="word-break: break-word;white-space: pre-wrap;"></span></p><p style="margin-top: 15px;margin-bottom: 15px;box-sizing: border-box;list-style: inherit;min-height: 1.8em;color: rgb(51, 51, 51);font-family: PingFangSC-Light, 'hiragino sans gb', 'helvetica neue', 'microsoft yahei ui', 'microsoft yahei', simsun, arial, sans-serif;font-size: 16px;white-space: pre-wrap;">Query语句</p><ol class="ol-level-0 list-paddingleft-2" style=""><li><p>Insert语句中，根据测试，批量一次插入1000条时效率最高，多于1000条时，要拆分，多次进行同样的插入，应该合并批量进行。注意query语句的长度要小于mysqld的参数 max_allowed_packet</p></li><li><p>查询条件中各种逻辑操作符性能顺序是and,or,in,因此在查询条件中应该尽量避免使用在大集合中使用in</p></li><li><p>永远用小结果集驱动大记录集，因为在mysql中，只有Nested Join一种Join方式，就是说mysql的join是通过嵌套循环来实现的。通过小结果集驱动大记录集这个原则来减少嵌套循环的循环次数，以减少IO总量及CPU运算次数</p></li><li><p>尽量优化Nested Join内层循环。</p></li><li><p>只取需要的columns，尽量不要使用select *</p></li><li><p>仅仅使用最有效的过滤字段，where 字句中的过滤条件少为好</p></li><li><p>尽量避免复杂的Join和子查询&nbsp;</p></li></ol><p><br></p><p style="margin-top: 15px;margin-bottom: 15px;box-sizing: border-box;list-style: inherit;min-height: 1.8em;color: rgb(51, 51, 51);font-family: PingFangSC-Light, 'hiragino sans gb', 'helvetica neue', 'microsoft yahei ui', 'microsoft yahei', simsun, arial, sans-serif;font-size: 16px;white-space: pre-wrap;">应用系统的优化</p><ol class="ol-level-0 list-paddingleft-2" style=""><li><p>合理使用cache，对于变化较少的部分活跃数据通过应用层的cache缓存到内存中，对性能的提升是成数量级的。</p></li><li><p>对重复执行相同的query进行合并，减少IO次数。</p></li><li><p>事务相关性最小原则</p><p><br></p></li></ol><p><br></p><p>第二加缓存，memcached,redis；</p><p><br></p><p>第三做主从复制或主主复制，读写分离，可以在应用层做，效率高。也可以用三方工具，第三方工具推荐360的atlas,其它的要么效率不高，要么没人维护；</p><p><br></p><p>第四mysql自带分区表，对你的应用是透明的，无需更改代码,但是sql语句是需要针对分区表做优化的，sql条件中要带上分区条件的列，从而使查询定位到少量的分区上，否则就会扫描全部分区，另外分区表还有一些坑，在这里就不多说了；</p><p><br></p><p>第五先做垂直拆分，其实就是根据你模块的耦合度，将一个大的系统分为多个小的系统，也就是分布式系统；</p><p><br></p><p>第六才是水平切分，针对数据量大的表，这一步最麻烦，最能考验技术水平，要选择一个合理的sharding key,为了有好的查询效率，表结构也要改动，做一定的冗余，应用也要改，sql中尽量带sharding key，将数据定位到限定的表上去查，而不是扫描全部的表。</p><p><br></p><p><br></p><p><span style="color:#1a1a1a;font-family:-apple-system, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif;"><span style="font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);">ps：</span></span></p><p><span style="color:#1a1a1a;font-family:-apple-system, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif;"><span style="font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);"><br></span></span></p><p><span style="color:#1a1a1a;font-family:-apple-system, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif;"><span style="font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);">db笔试面试题库</span></span></p><p><span style="color:#1a1a1a;font-family:-apple-system, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif;"><span style="font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);">https://zhuanlan.zhihu.com/p/26146000</span></span></p><h1 class="QuestionHeader-title" data-reactid="82" style="margin-top: 12px;margin-bottom: 4px;font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Microsoft YaHei', 'Source Han Sans SC', 'Noto Sans CJK SC', 'WenQuanYi Micro Hei', sans-serif;font-size: 22px;font-weight: 600;line-height: 32px;font-synthesis: style;color: rgb(26, 26, 26);white-space: normal;"><span style="font-size: 15px;">如何将Oracle数据导入MySQL</span></h1><p><span style="color:#1a1a1a;font-family:-apple-system, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif;"><span style="font-size: 15px;white-space: pre-wrap;background-color: rgb(255, 255, 255);">https://www.zhihu.com/question/20200212</span></span></p>
                    
                </div>
                
                
                
            </div>
          
        <script type="text/javascript" src="../edu/tongji.js">
</script>
</body>
</html>
