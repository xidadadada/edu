<html>
<body>
    <script type="text/javascript" src="../edu/day.js">
</script>
<script type="text/javascript" src="../edu/ps.js">
</script>
<div class=“rich_media_area_primary” style="margin:0px auto; width:800px;">
                
<div class="rich_media_area_primary">
                
                <h2 class="rich_media_title" title="php 扩展">php 扩展</h2>
                <div class="rich_media_meta_list">
                    <!-- <span class="rich_media_meta meta_original_tag dn">原创</span>
                    <a class="rich_media_meta meta_enterprise_tag" href="javascript:;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/QpRnoicU4ABbOPuPdO5LdEerNmZokInOemPVx0tBaIjgy7DVrHVzWtcEcOZNpgz46yf9AprEpPIn7ux57e6nyYA/0?wx_fmt=jpeg"></a> -->
                    <em class="rich_media_meta rich_media_meta_text">2018-02-24</em>
                    <em class="rich_media_meta rich_media_meta_text"></em>
                    <span class="rich_media_meta rich_media_meta_link" title="请发送到手机查看完整效果">学习交流</span>
                </div>
                
                              
                <div class="rich_media_content">
                    
                    <p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">开发扩展目的：</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">1）提高效率，如复杂的图像算法</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">2）有些系统调用不能用PHP直接访问，比如Linux下的fork函数创建一个进程，需要编写扩展</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">3）需要商业化一个应用，又不想暴露源码</p><p style="margin-bottom: 16px;box-sizing: border-box;font-size: 16px;color: rgb(79, 79, 79);line-height: 26px;text-align: justify;font-family: 'PingFang SC', 'Microsoft YaHei', SimHei, Arial, SimSun;white-space: normal;">动态加载：利用ext_skel工具编译生成so模块，修改php.ini，动态加载即可&nbsp;<br style="box-sizing: border-box;">静态编译：将编写的模块静态编译到PHP，需要重新编译PHP</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">PHP的源目录</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp; ext：存放动态和内建模块的目录，在这里可以找到所有的官方扩展，以后也会在这里放新的扩展</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp;main：包含PHP的主要的宏定义</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp;pear：PHP的扩展与应用库目录，包含pear的核心文件</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp;sapi：包含不同服务器抽象层的代码</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp;TSRM：zned和php的线程安全资源管理器目录</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp;zend：包含zend引擎的所有文件，可以找到所有Zend &nbsp;API的定义</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';"><span style="box-sizing: border-box;outline: 0px;line-height: 1.6;">&nbsp;一般还会包括几个文件：</span></p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp;main/php.h : 位于main目录下，包含绝大部分的PHP宏以及PHP &nbsp;API的定义</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp;Zend/zend.h : 位于Zend目录下包含绝大部分的zend宏和Zend API的定义</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp;Zend/zend_API.h : 位于zend目录下，包含Zend API的定义</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">ext_skel工具：</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">在ext的源码目录下，有ext_skel和ext_skel_win32.h两个自动化构建扩展开发的框架工具，前者在Linux下使用，后者在win下使用</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">win下：</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">1）使用ext_skel工具编写扩展</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp; a） cd到PHP源码目录的ext目录下，输入以下命令扩展框架：</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; php ext_skel_win32.php &nbsp; --extname = myext (如果提示php不是内部或者外部命令，也不是可运行的程序或批处理文件，请先安装PHP，并且添加php到环境变量中)</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp;b）安装成功之后会发现ext目录下多了一个myext目录，myext目录中，myext.dsp是VC++的工程文件</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp;c）编译安装扩展</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp;&nbsp;&nbsp;&nbsp;﻿&nbsp;&nbsp;&nbsp;&nbsp;﻿&nbsp;用VC++打开myext.dsp工程文件，按编译按钮开始编译这个扩展，在编译的过程中，会发现编译出错提示：link fatal error：can'tfind input files &nbsp;"php5ts.lib"，从PHP的安装目录下(注意不是php的源码目录，是安装目录)的dev目录中把php5ts.lib复制到创建的扩展目录(myext)目录下，再次按编译按钮，这次可以成功编译</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp;d）编译成之后源代码的根目录会多出一个Release_TS目录，在该目录中有刚刚编译好的动态扩展文件 php_myext.dll,如果找不到Release_TS目录，而找到了debug_TS目录，请把VC++的编译模式改成release模式</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">到此已经编译出了一个PHP扩展文件，只要把编译出的php_myext.dll放到安装目录的ext目录下，在php.ini中添加extension =&nbsp;php_myext.dll 并重启web服务器就可以了，安装完成之后就可以像其它扩展一样在phpinfo里看到扩展信息了，可以调用一下扩展封装的函数来确认是否安装成功</p><p><br></p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">Linux下：</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp; &nbsp; a）安装php-dev包</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp; &nbsp; 使用php-dev包中的phpize工具可以减少很多繁琐的步骤，如果用php源码编译的话，就可以不用安装php-dev包，源码中已经饱和phpize工具，在ubutun下安装dev包的命令是 sudo &nbsp;spt-get install &nbsp;php5-dev<span style="box-sizing: border-box;outline: 0px;line-height: 1.6;">安装完成后，可以使用以下命令查看是否安装成功 phpize --version，如果显示phpize的版本信息就证明安装成功</span></p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">&nbsp; &nbsp; b）使用ext_skel工具，在php的源码目录下有个ext_Skel文件，用法与win下的ext_skel_win32.h类似</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">eg：创建一个php扩展&nbsp;</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">./ext_skel &nbsp;--extname=myext &nbsp;然后，可以看到一系列的提示步骤</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">c）编译安装扩展</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">在生成扩展之后，进入到扩展目录，使用phpize命令生成扩展的配置工具，然后编译和安装：</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">cd myext</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">phpize</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">./configure &nbsp;--with-php-config =&nbsp;/usr/local/php5/bin/php-config</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">make</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">maketest</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">make install</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">编译完成后可以在&nbsp;/usr/local/php5/lib/php/extensions/no_debug_non_.../下看到生成的扩展文件myext.so</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">然后在phpini文件中添加扩展信息 &nbsp;extension = myext.so</p><p style="margin-top: 0.667rem;margin-bottom: 0.667rem;box-sizing: border-box;outline: 0px;font-size: 15px;color: rgb(79, 79, 79);line-height: 24px;min-height: 26px;text-align: justify;white-space: normal;font-family: 'Helvetica Neue';">d）使用 php -m | grep myext 查看扩展是否安装成功</p><p><br></p><p>ps：</p><p><span style="font-size: 18px;color: rgb(44, 48, 51);font-family: 'PingFang SC', 'Microsoft YaHei', SimHei, Arial, SimSun;font-weight: 700;background-color: rgb(255, 255, 255);"><br></span></p><p><span style="font-size: 18px;color: rgb(44, 48, 51);font-family: 'PingFang SC', 'Microsoft YaHei', SimHei, Arial, SimSun;font-weight: 700;background-color: rgb(255, 255, 255);">gdb调试PHP扩展函数</span></p><p>http://blog.csdn.net/leonpengweicn/article/details/43668095</p><p><span style="font-size: 18px;color: rgb(44, 48, 51);font-family: 'PingFang SC', 'Microsoft YaHei', SimHei, Arial, SimSun;font-weight: 700;background-color: rgb(255, 255, 255);"><br></span></p><p><span style="font-size: 18px;color: rgb(44, 48, 51);font-family: 'PingFang SC', 'Microsoft YaHei', SimHei, Arial, SimSun;font-weight: 700;background-color: rgb(255, 255, 255);">PHP7扩展开发之对象方式使用lib库</span></p><p>http://blog.csdn.net/u013474436/article/details/79028116</p><p><br></p><p><span style="color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';font-size: 16px;background-color: rgb(255, 255, 255);">一个PHP7 代码加密扩展</span></p><p><span style="color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';font-size: 16px;background-color: rgb(255, 255, 255);">https://github.com/lihancong/tonyenc</span></p><p><span style="color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';font-size: 16px;background-color: rgb(255, 255, 255);"><br></span></p>
                    
               </div>
                
                
                
            </div>
          
        <script type="text/javascript" src="../edu/tongji.js">
</script>
</body>
</html>
